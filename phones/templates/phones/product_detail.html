{% extends 'main/layout.html' %}

{% block title %}{{ product.name }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <!-- Левая колонка с изображением -->
        <div class="col-md-5">
            {% if images %}
                <!-- Главное изображение -->
                <div class="text-center position-relative">
                    <button class="arrow left" onclick="prevImage()">&#10094;</button>
                    <img id="mainImage" src="{{ images.0.image.url }}" class="img-fluid rounded main-image" alt="{{ product.name }}">
                    <button class="arrow right" onclick="nextImage()">&#10095;</button>
                </div>
            {% endif %}

            <!-- Миниатюры изображений -->
            <div class="mt-3 d-flex gap-2">
                {% for image in images %}
                    <img src="{{ image.image.url }}"
                         class="thumbnail rounded {% if forloop.first %}active-thumbnail{% endif %}"
                         onclick="changeImage('{{ image.image.url }}', this)"
                         alt="Thumbnail">
                {% endfor %}
            </div>
        </div>

        <!-- Правая колонка с информацией о товаре -->
        <div class="col-md-6 d-flex flex-column justify-content-center">
            <h2>{{ product.name }}</h2>
            <h4 class="text-success">Price: {{ product.price }} $</h4>


            <button class="btn btn-outline-danger wishlist-btn" data-product-id="{{ product.id }}">
                <i class="fa-solid fa-heart"></i> Add to Wishlist
            </button>

            <a href="{% url 'checkout' %}" class="btn btn-primary btn-lg mt-3">Buy Now</a>
            <a href="{% url 'add_to_cart' product.id %}" class="btn btn-success btn-lg mt-3">Add to Cart</a>
            <a href="{% url 'product_list' %}" class="btn btn-secondary mt-2">Back to Products</a>

        </div>
    </div>

    <!-- Описание товара -->
    <div class="row mt-4">
        <div class="col-md-12">
            <h3>Description</h3>
            <p>{{ product.description|linebreaks }}</p>
        </div>
    </div>
</div>

<!-- Стили -->
<style>
    /* Главное изображение */
    .main-image {
        max-width: 100%;
        max-height: 400px;
        object-fit: contain;
    }

    /* Миниатюры */
    .thumbnail {
        width: 75px;
        height: 75px;
        cursor: pointer;
        transition: transform 0.2s, border 0.2s;
        border: 2px solid transparent;
        object-fit: cover;
    }
    .thumbnail:hover {
        transform: scale(1.1);
    }
    .active-thumbnail {
        border: 2px solid #007bff;
    }

    /* Стрелки для переключения изображений */
    .arrow {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background: rgba(0, 0, 0, 0.5);
        color: white;
        border: none;
        padding: 10px 15px;
        cursor: pointer;
        font-size: 20px;
        z-index: 10;
        transition: background 0.3s;
    }
    .arrow:hover {
        background: rgba(0, 0, 0, 0.8);
    }
    .left {
        left: 10px;
    }
    .right {
        right: 10px;
    }

    .product-description {
        background: #f9f9f9;
        padding: 15px;
        border-radius: 10px;
        font-size: 16px;
        line-height: 1.6;
    }
    .product-description p {
        margin-bottom: 10px;
    }
</style>

<!-- JavaScript -->
<script>
let images = [{% for image in images %}"{{ image.image.url }}",{% endfor %}];
let currentIndex = 0;

function changeImage(imageUrl, clickedThumbnail) {
    document.getElementById("mainImage").src = imageUrl;
    currentIndex = images.indexOf(imageUrl);

    // Удаляем активный класс у всех миниатюр
    document.querySelectorAll(".thumbnail").forEach(img => img.classList.remove("active-thumbnail"));

    // Добавляем активный класс к нажатой миниатюре
    clickedThumbnail.classList.add("active-thumbnail");
}

function prevImage() {
    currentIndex = (currentIndex - 1 + images.length) % images.length;
    updateMainImage();
}

function nextImage() {
    currentIndex = (currentIndex + 1) % images.length;
    updateMainImage();
}

function updateMainImage() {
    let mainImage = document.getElementById("mainImage");
    mainImage.src = images[currentIndex];

    // Обновляем активную миниатюру
    document.querySelectorAll(".thumbnail").forEach((img, index) => {
        img.classList.toggle("active-thumbnail", index === currentIndex);
    });
}

document.addEventListener("DOMContentLoaded", function () {
    document.querySelector(".wishlist-btn").addEventListener("click", function () {
        let button = this;
        let productId = button.getAttribute("data-product-id");

        fetch("{% url 'toggle_wishlist_ajax' %}", {
            method: "POST",
            headers: {
                "X-CSRFToken": "{{ csrf_token }}",
                "Content-Type": "application/x-www-form-urlencoded"
            },
            body: "product_id=" + productId
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                if (data.in_wishlist) {
                    button.classList.remove("btn-outline-danger");
                    button.classList.add("btn-danger");
                    button.innerHTML = '<i class="fa-solid fa-heart"></i> Remove from Wishlist';
                } else {
                    button.classList.remove("btn-danger");
                    button.classList.add("btn-outline-danger");
                    button.innerHTML = '<i class="fa-solid fa-heart"></i> Add to Wishlist';
                }
            }
        })
        .catch(error => console.error("Error:", error));
    });
});
</script>

{% endblock %}












